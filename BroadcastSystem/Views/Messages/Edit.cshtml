@model BroadcastSystem.Models.Message
@{
    ViewBag.Title = "Edit";
}
<h2>Edit</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Message</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.ID)
        <div class="form-group">
            @Html.LabelFor(model => model.AuthorID, "AuthorID", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("AuthorID", null, htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.AuthorID, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
            </div>
        </div>


        <div class="form-group">
            @Html.LabelFor(model => model.Content, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <textarea id="Content" rows="10" cols="30" style="height:440px" name="Content"></textarea>
                @Html.ValidationMessageFor(model => model.Content, "", new { @class = "text-danger" })
            </div>
        </div>





        <div class="form-group">
            @Html.LabelFor(model => model.From, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-4">
                <input id="start" class="datetimepicker" name="From" style="width: 100%;" />
                @Html.ValidationMessageFor(model => model.From, "", new { @class = "text-danger" })

            </div>

            @Html.LabelFor(model => model.To, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-4">
                <input id="end" class="datetimepicker" name="To" style="width: 100%;" />
                @Html.ValidationMessageFor(model => model.To, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.IsBroadcasting, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class="checkbox">
                    @Html.EditorFor(model => model.IsBroadcasting)
                    @Html.ValidationMessageFor(model => model.IsBroadcasting, "", new { @class = "text-danger" })
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <a href="/Messages" class="btn btn-default" style="width: 150px;">
                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Back
                </a>
                <button id="preview" class="btn btn-primary" style="width: 150px;">
                    <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Preview
                </button>
                <button type="submit" name="Update" class="btn btn-success" style="width: 150px;">
                    <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Update
                </button>
            </div>
        </div>



        @*<div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" id="btnSave" value="Save" class="btn btn-default" />
            </div>
        </div>*@


    </div>
}

<div class="form-group">

    <script>
        // When clicked preview button, append the preview to the view page
        $("#preview").click(function (e) {
            e.preventDefault();
            var titleText = $("#Title").val();
            var contentText = $("#Content").data("kendoEditor").value();
            // Validate manually before preview
            if (titleText == "") {
                $("#Title").focus();
                $("#Title").next().text("This field is required.");
            } else if (contentText == "") {
                $('#Content').data('kendoEditor').body.focus();
                $("#Content").parent().parent().parent().parent().next().text("This field is required.");
            } else {
                $("#previewBox").html(
                    '<div class="broadcast">' +
                    '<div class="trapezoid"></div>' +
                    '<div class="newtxt">NEW*</div>' +
                    '<button type="button" class="closebtn">Close X</button>' +
                    '<div class="container">' +
                    '<div class="title">' + titleText + '</div>' +
                    '<div class="content">' + contentText + '</div>' +
                    '<div class="readmore"><a href="#">Read more</a></div>' +
                    '</div></div>'
                );

                $("#previewBox .readmore").click(function () {
                    $("#previewWindow").html(contentText);
                    $("#previewWindow").kendoWindow({
                        width: $("body").width() * 0.7 + "px",
                        title: titleText,
                        visible: false,
                        actions: [
                            "Close"
                        ],
                    }).data("kendoWindow").center().open();
                });

                $('html,body').animate({
                    scrollTop: $("#previewBox").offset().top - 132
                }, 500);
                return false;
            }
        });
       
        $(document).ready(function () {
            var editor = $("#Content").data("kendoEditor");
            editor.value(@Html.Raw(Json.Encode(Model.Content)));
        });


        $("form").submit(function () {
            var editor = $("#Content").data("kendoEditor");
            Model.Content = editor.value();
        });

    </script>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
